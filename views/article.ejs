<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= article.title %> - NewsPortal</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <%- include('partials/navbar') %>

    <main>
      <article class="article-detail">
        <div class="container-narrow">
          <div class="article-header">
            <span class="category-badge"><%= article.category %></span>
            <h1><%= article.title %></h1>
            <div class="article-meta">
              <span>üë§ <%= article.author %></span>
              <span>üìÖ <%= article.date.toLocaleDateString() %></span>
              <span>üëÅÔ∏è <%= article.views %> views</span>
            </div>
          </div>

          <img
            src="<%= article.image %>"
            alt="<%= article.title %>"
            class="article-image"
          />

          <div class="article-body"><%- article.content %></div>

          <div class="article-actions">
            <button class="btn-share">üì§ Share Article</button>
          </div>
        </div>
      </article>

      <!-- Comments Section -->
      <section class="comments-section">
        <div class="container-narrow">
          <h2 class="section-title">Comments (<%= comments.length %>)</h2>

          <!-- Comment Form -->
          <% if (user) { %>
          <div class="comment-form-container">
            <form
              action="/article/<%= article.id %>/comment"
              method="POST"
              class="comment-form"
            >
              <div class="form-group">
                <label for="content">Add a comment</label>
                <textarea
                  id="content"
                  name="content"
                  rows="4"
                  placeholder="Share your thoughts..."
                  required
                ></textarea>
              </div>
              <button type="submit" class="btn btn-primary">
                Post Comment
              </button>
            </form>
          </div>
          <% } else { %>
          <div class="comment-login-prompt">
            <p>
              Please <a href="/auth/login">login</a> or
              <a href="/auth/register">register</a> to leave a comment.
            </p>
          </div>
          <% } %>

          <!-- Comments List -->
          <div class="comments-list">
            <% if (comments.length > 0) { %> <% comments.forEach(comment => { %>
            <div class="comment-card">
              <div class="comment-header">
                <div class="comment-author">
                  <span class="author-avatar">üë§</span>
                  <div>
                    <strong><%= comment.username %></strong>
                    <span class="comment-date"
                      ><%= comment.createdAt.toLocaleDateString() %> at <%=
                      comment.createdAt.toLocaleTimeString() %></span
                    >
                  </div>
                </div>
                <% if (user && (user.id === comment.userId || user.role ===
                'admin')) { %>
                <form
                  action="/comment/<%= comment.id %>/delete"
                  method="POST"
                  class="comment-delete-form"
                  onsubmit="return confirm('Are you sure you want to delete this comment?');"
                >
                  <input
                    type="hidden"
                    name="articleId"
                    value="<%= article.id %>"
                  />
                  <button type="submit" class="btn-delete-comment">
                    Delete
                  </button>
                </form>
                <% } %>
              </div>
              <div class="comment-content"><%= comment.content %></div>
            </div>
            <% }); %> <% } else { %>
            <div class="no-comments">
              <p>No comments yet. Be the first to comment!</p>
            </div>
            <% } %>
          </div>
        </div>
      </section>
    </main>

    <%- include('partials/footer') %>
  </body>
</html>
